<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="MEDcode" content="width=device-width, initial-scale=1.0">
    <title>SPAR</title>
    <link rel="stylesheet" href="/static/Css/Pagina_Base.css">
    <link rel="stylesheet" href="/static/Css/BaseKit.css">
    <link rel="icon" href="/static/imagens/Logo.png" type="image/png">
    <script src="/static/JavaScript/dark_mode.js"></script>
</head>

<body>
    <header>
        <button class="dark-mode-toggle" id="darkModeToggle">ðŸŒ™</button>
        <a href="/" id="Titulo">
            <img src="/static/imagens/Logo.png" alt="Imagem da logo do grupo">
            <h1>SPAR</h1>
        </a>

        <button class="user"><img src="/static/imagens/Paciente.avif" alt=""></button>
    </header>

    <section id="Info">
        <h2>Consultas</h2>
    </section>

    <section class="container">
        <button class="btn_registrar" onclick="adicionarItem()">Adicionar Consulta</button>

        <div class="grid-container" id="gridContainer">
            <div class="empty-state" id="emptyState">
                <span>ðŸ“‹</span>
                <p>Sem consultas marcadas</p>
            </div>
            <!-- Itens serÃ£o adicionados aqui -->
        </div>
    </section>

    <script>
        let contador = 1;

        function adicionarItem() {
            const grid = document.getElementById('gridContainer');
            const emptyState = document.getElementById('emptyState');
            
            // Remover mensagem de estado vazio se existir
            if (emptyState) {
                emptyState.remove();
            }
            
            // Data atual formatada
            const dataAtual = new Date();
            const dataFormatada = dataAtual.toLocaleDateString('pt-BR');
            const dataISO = dataAtual.toISOString().split('T')[0];
            
            // Criar novo item
            const novoItem = document.createElement('div');
            novoItem.className = 'grid-item';
            novoItem.setAttribute('data-consulta-id', contador);
            novoItem.innerHTML = `
                <div class="item-header">
                    <h3>Consulta ${contador}</h3>
                    <span class="item-status">Agendada</span>
                </div>
                <div class="item-content">
                    <p><strong>Paciente:</strong> Paciente ${contador}</p>
                    <p><strong>MÃ©dico:</strong> Dr. Silva</p>
                    <p><strong>HorÃ¡rio:</strong> 14:00</p>
                    <p><strong>Data:</strong> <span class="consulta-date">${dataFormatada}</span></p>
                    <p><strong>Status:</strong> <span class="status-text">Agendada</span></p>
                </div>
                <div class="item-details" style="display: none;">
                    <div class="detail-section">
                        <h4>Detalhes da Consulta</h4>
                        <p><strong>Sintomas:</strong> Dor de cabeÃ§a, febre</p>
                        <p><strong>ObservaÃ§Ãµes:</strong> Repouso recomendado</p>
                        <p><strong>PrÃ³xima consulta:</strong> 15 dias</p>
                    </div>
                    
                    <!-- SECTION DO CALENDÃRIO COMO INPUT DATE -->
                    <section class="calendar-section" style="display: none;">
                        <div class="calendar-input-container">
                            <label for="dateInput-${contador}">Escolha a nova data:</label>
                            <div class="input-wrapper">
                                <input type="date" 
                                       id="dateInput-${contador}" 
                                       class="date-input"
                                       value="${dataISO}"
                                       min="${new Date().toISOString().split('T')[0]}">
                                <span class="calendar-icon">ðŸ“…</span>
                            </div>
                            <div class="calendar-actions">
                                <button class="btn btn-cancel" onclick="fecharCalendario(this)">Cancelar</button>
                                <button class="btn btn-confirm" onclick="confirmarData(this)">Confirmar Data</button>
                            </div>
                        </div>
                    </section>
                    
                    <!-- BOTÃ•ES NO CANTO INFERIOR DIREITO -->
                    <div class="button-container">
                        <button class="btn btn-cancel" onclick="cancelarConsulta(this)">
                            <span class="btn-icon">âœ•</span>
                            Cancelar Consulta
                        </button>
                        <button class="btn btn-reschedule" onclick="reagendarConsulta(this)">
                            <span class="btn-icon">â†»</span>
                            Reagendar Consulta
                        </button>
                    </div>
                </div>
            `;
            
            // Adicionar evento de clique
            novoItem.addEventListener('click', function(e) {
                // Impedir que o clique nos botÃµes feche o item
                if (!e.target.closest('.btn') && !e.target.closest('.calendar-section')) {
                    toggleItemDetails(this);
                }
            });
            
            // Adicionar ao grid
            grid.appendChild(novoItem);
            
            contador++;
        }

        function toggleItemDetails(item) {
            const details = item.querySelector('.item-details');
            const isExpanded = details.style.display === 'block';
            
            // Fechar todos os outros itens expandidos
            document.querySelectorAll('.item-details').forEach(detail => {
                detail.style.display = 'none';
            });
            document.querySelectorAll('.grid-item').forEach(gridItem => {
                gridItem.classList.remove('expanded');
            });
            
            // Alternar o item clicado
            if (!isExpanded) {
                details.style.display = 'block';
                item.classList.add('expanded');
                
                // Scroll para o item expandido
                item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // FUNÃ‡ÃƒO PARA CANCELAR CONSULTA
        function cancelarConsulta(btn) {
            const item = btn.closest('.grid-item');
            const consultaNum = item.querySelector('h3').textContent;
            
            if (confirm(`Tem certeza que deseja cancelar a ${consultaNum}?`)) {
                item.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    item.remove();
                    
                    // Verificar se nÃ£o hÃ¡ mais itens e mostrar empty state
                    const grid = document.getElementById('gridContainer');
                    if (grid.children.length === 0) {
                        grid.innerHTML = `
                            <div class="empty-state" id="emptyState">
                                <span>ðŸ“‹</span>
                                <p>Sem consultas marcadas</p>
                            </div>
                        `;
                    }
                }, 300);
            }
            event.stopPropagation();
        }

        // FUNÃ‡ÃƒO PARA REAGENDAR CONSULTA
        function reagendarConsulta(btn) {
            const item = btn.closest('.grid-item');
            const calendarSection = item.querySelector('.calendar-section');
            const buttonContainer = item.querySelector('.button-container');
            const dateInput = item.querySelector('.date-input');
            const currentDate = item.querySelector('.consulta-date').textContent;
            
            // Converter data atual para ISO (para preencher o input)
            const [dia, mes, ano] = currentDate.split('/');
            const dataISO = `${ano}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;
            dateInput.value = dataISO;
            
            // Configurar data mÃ­nima como hoje
            const today = new Date().toISOString().split('T')[0];
            dateInput.min = today;
            
            // Esconder botÃµes e mostrar calendÃ¡rio
            buttonContainer.style.display = 'none';
            calendarSection.style.display = 'block';
            
            // Focar no input de data
            setTimeout(() => {
                dateInput.focus();
            }, 100);
            
            // Scroll para o calendÃ¡rio
            calendarSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            event.stopPropagation();
        }

        function fecharCalendario(btn) {
            const item = btn.closest('.grid-item');
            const calendarSection = item.querySelector('.calendar-section');
            const buttonContainer = item.querySelector('.button-container');
            
            // Esconder calendÃ¡rio e mostrar botÃµes
            calendarSection.style.display = 'none';
            buttonContainer.style.display = 'flex';
        }

        function confirmarData(btn) {
            const item = btn.closest('.grid-item');
            const dateInput = item.querySelector('.date-input');
            const calendarSection = item.querySelector('.calendar-section');
            const buttonContainer = item.querySelector('.button-container');
            
            if (!dateInput.value) {
                alert('Por favor, selecione uma data para reagendar.');
                return;
            }
            
            // Formatar data para exibiÃ§Ã£o
            const selectedDate = new Date(dateInput.value);
            const formattedDate = selectedDate.toLocaleDateString('pt-BR');
            
            // Atualizar a data no item (tanto no conteÃºdo principal quanto no header)
            const dateElement = item.querySelector('.consulta-date');
            dateElement.textContent = formattedDate;
            
            // Atualizar o status para "Reagendada"
            const statusElement = item.querySelector('.status-text');
            statusElement.textContent = 'Reagendada';
            statusElement.className = 'status-text status-reagendada';
            
            // Atualizar tambÃ©m o status no header
            const headerStatus = item.querySelector('.item-status');
            headerStatus.textContent = 'Reagendada';
            headerStatus.className = 'item-status status-reagendada';
            
            // Esconder calendÃ¡rio e mostrar botÃµes
            calendarSection.style.display = 'none';
            buttonContainer.style.display = 'flex';
            
            alert(`Consulta reagendada para ${formattedDate}`);
        }

        // Melhorar experiÃªncia do input date
        document.addEventListener('DOMContentLoaded', function() {
            const supportsDateInput = (function() {
                const input = document.createElement('input');
                input.setAttribute('type', 'date');
                const notADateValue = 'not-a-date';
                input.setAttribute('value', notADateValue);
                return input.value !== notADateValue;
            })();
            
            if (!supportsDateInput) {
                document.querySelectorAll('.date-input').forEach(input => {
                    input.type = 'text';
                    input.placeholder = 'DD/MM/AAAA';
                    
                    input.addEventListener('input', function(e) {
                        let value = e.target.value.replace(/\D/g, '');
                        if (value.length > 2) {
                            value = value.substring(0, 2) + '/' + value.substring(2);
                        }
                        if (value.length > 5) {
                            value = value.substring(0, 5) + '/' + value.substring(5, 9);
                        }
                        e.target.value = value;
                    });
                });
            }
        });
    </script>
</body>
</html>